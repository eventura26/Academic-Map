<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Academic Map - Administration</title>
        <link href=styles.css rel=stylesheet />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
        <style>
            .container{
                text-align: center;
                margin-top:24px
            }
            .control-btns{
                margin-top: 20px;;
            }
            .course-list-container {
    display: none; /* Initially hidden */
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 20px;;

}

.course-item {
    margin: 14px;
    flex-basis: calc(33% - 28px); /* For 3 columns, adjust for margins */
    box-sizing: border-box;
}

.course-selection:hover{
    color:blue    
}
            
        </style>
    </head>
<body>
    <div class="container">
        <h2>Admin Portal</h2>    
        
        <div class="control-btns">
            <button type="button" class="btn btn-info" onclick="toggleCourseList()">View All Courses</button>
            <button class="btn btn-info dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                View/Edit by Degree Plan
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" onclick="showPlan('Computer Science')" href="#">Computer Science</a>
                <a class="dropdown-item" onclick="showPlan('Digital Media') " href="#">Digital Media</a>
            </div>
            <button type="button" class="btn btn-success">+ Add a Course</button>
            <button type="button" class="btn btn-secondary" onclick="window.open('/academicmap.html', '_blank')">Student View</button>
        </div>
 

        <div id="courseList" class="course-list-container">
            <!-- <h2 style="text-align: center;">Course List</h2> -->
        </div>

        <!-- <div id="courseModal" class="course-modal" style="display: none">
            <div id="courseModalContent" class="modal-content">

            </div>
        </div> -->

        <div id="courseModal" style="display: none">
            <div id="courseModalContent">

            </div>
      
        </div>

</div>

    <script>

function loadData() {
    let storedData = localStorage.getItem('courseData');
    if (storedData) {
        const data = JSON.parse(storedData);
        renderCourses(data.allCourses); // Ensure this function processes the course data correctly
    } else {
        fetch('courses.json')
            .then(response => response.json())
            .then(data => {
                localStorage.setItem('courseData', JSON.stringify(data));
                renderCourses(data.allCourses);
            });
    }
}

document.addEventListener('DOMContentLoaded', loadData);



        document.addEventListener('DOMContentLoaded', function() {
            fetch('courses.json')
            .then(response => response.json())
            .then(data => renderCourses(data.allCourses));
        });

        function renderCourses(allCourses) {
            const courseList = document.getElementById('courseList');

            const sortedCourses = Object.entries(allCourses).sort((a, b) => {
                const courseCodeA = a[0];
                const courseCodeB = b[0];
                return courseCodeA.localeCompare(courseCodeB);
            });

            sortedCourses.forEach(([courseCode, course]) => {
    const courseElement = document.createElement('div');
    courseElement.className = 'course-item';
    courseElement.innerHTML = `
        <img src="/rubbish-bin.svg" alt="trash icon" style="width:24px; cursor:pointer;">
        <span class="course-text clickable"><strong>${courseCode}</strong>: ${course.courseName}</span>`;
    
    // Event listener for the delete icon
    courseElement.querySelector('img').addEventListener('click', (event) => {
        event.stopPropagation();
        deleteCourse(courseCode, courseElement);
    });

    // Event listener for the text part
    courseElement.querySelector('.course-text').addEventListener('click', () => {
        showModal(courseCode, course);
    });

    courseElement.setAttribute('data-course-code', courseCode);

    courseList.appendChild(courseElement);
});


            const trashIcon = courseElement.querySelector('img');
    trashIcon.addEventListener('click', (event) => {
        event.stopPropagation();
        deleteCourse(courseCode, courseElement);
    });
        }

        function toggleCourseList() {
    let courseList = document.getElementById('courseList');
    if (courseList.style.display === 'none' || courseList.style.display === '') {
        courseList.style.display = 'flex';
    } else {
        courseList.style.display = 'none';
    }
}

function deleteCourse(courseCode) {
    
    const isConfirmed = confirm(`Are you sure you want to delete the course: ${courseCode}?`);
    if (isConfirmed) {
        // Retrieve the current data
        let data = JSON.parse(localStorage.getItem('courseData'));

        // Delete the course from the data
        delete data.allCourses[courseCode];

        // Update localStorage
        localStorage.setItem('courseData', JSON.stringify(data));

        // Remove the course element from the UI
        const courseElement = document.querySelector(`.course-item[data-course-code="${courseCode}"]`);
        if (courseElement) {
            courseElement.remove();
        }

        alert(`Course ${courseCode} deleted`);
        closeModal();

    }
}

function saveEditedCourse() {
    const courseCode = document.getElementById("courseCode").value;
    const updatedCourseName = document.getElementById("courseName").value;
    const updatedCreditHours = document.getElementById("courseHours").value;
    const updatedDescription = document.getElementById("courseDescription").value;

    // Retrieve the current data
    let data = JSON.parse(localStorage.getItem('courseData'));

    // Check if the courseCode exists
    if (data.allCourses[courseCode]) {
        // Update the course details
        data.allCourses[courseCode] = {
            courseName: updatedCourseName,
            creditHours: updatedCreditHours,
            Description: updatedDescription
        };

        // Update localStorage
        localStorage.setItem('courseData', JSON.stringify(data));

        // Update the UI to reflect the changes
        // ...

        alert(`Course ${courseCode} updated`);
    } else {
        alert('Error: Invalid course code');
    }

    closeModal();
}

function updateCourseInUI(courseCode, updatedCourse) {
    const courseElement = document.querySelector(`.course-item[data-course-code="${courseCode}"]`);

    if (courseElement) {
        // Update the content of the course item
        // Adjust these selectors to match your HTML structure
        // courseElement.querySelector('.course-code').textContent = courseCode;
        // courseElement.querySelector('.course-name').textContent = updatedCourse.courseName;
        // courseElement.querySelector('.course-hours').textContent = `${updatedCourse.creditHours} hours`;
        // courseElement.querySelector('.course-description').textContent = updatedCourse.description;
    }
}

    
function showModal(courseCode, course) {
    console.log(course)
    console.log(courseCode)

    const {courseName, creditHours, Description } = course;

    const modal = document.getElementById("courseModal");
    modal.classList.add("course-ed-modal");
    const modalContent = document.getElementById("courseModalContent");
    modalContent.innerHTML = "";
    modalContent.classList.add("modal-content");

    // Admin page: show form for editing
    modalContent.innerHTML = `
        <form id="editCourseForm" class='edit-form'>
            <h3>Edit Course</h3>
            <label for="courseCode">Course Code:</label>
            <input type="text" id="courseCode" name="courseCode" value="${courseCode}">
            <label for="courseName">Course Name:</label>
            <input type="text" id="courseName" name="courseName" value="${courseName}">
            <label for="courseHours">Credit Hours:</label>
            <input type="number" id="courseHours" name="courseHours" value="${creditHours}">
            <label for="courseDescription">Description:</label>
            <textarea id="courseDescription" name="courseDescription" style="height: 100px;">${Description}</textarea>
            <div style="margin-top:14px">
                <button type="button" class="btn btn-success" onclick="saveEditedCourse()">Save Changes</button>
                <button type="button" class="btn btn-danger" onclick="deleteCourse('${courseCode}')">Delete Course</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Close</button>
            </div>
        </form>
    `;

    document.getElementById("editCourseForm").addEventListener("submit", function (e) {
        e.preventDefault();

        // Get updated course details from the form
        const updatedCourse = {
            Code: document.getElementById("courseCode").value,
            Name: document.getElementById("courseName").value,
            Hours: parseInt(document.getElementById("courseHours").value, 10),
            Description: document.getElementById("courseDescription").value,
        };

        // Update the course list
        updateTableWithEditedCourse(courseCode, updatedCourse);

        closeModal();
    });
    modal.style.display = "block";
}

function closeModal() {
    document.getElementById("courseModal").style.display = "none";
}

    </script>

</body>
</html>